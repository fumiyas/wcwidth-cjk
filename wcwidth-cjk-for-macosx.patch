diff -u wcwidth-cjk.orig/Makefile wcwidth-cjk/Makefile
--- wcwidth-cjk.orig/Makefile	2015-10-28 18:39:39.000000000 +0900
+++ wcwidth-cjk/Makefile	2015-10-28 18:41:38.000000000 +0900
@@ -1,10 +1,10 @@
-BUILD_TARGETS = wcwidth-cjk wcwidth-cjk.so
+BUILD_TARGETS = wcwidth-cjk libwcwidth-cjk.dylib
 
 CC = gcc
 #CC = gcc46 # For FreeBSD
 #CC = clang # For FreeBSD 10, suggested
 CFLAGS = -O2 -Wall -fPIC -Dwcwidth_cjk=wcwidth -Dwcswidth_cjk=wcswidth
-LDSHARED = $(CC) -shared
+LDSHARED = $(CC) -dynamiclib
 LDFLAGS =
 
 prefix = /usr/local
@@ -16,15 +16,15 @@
 
 clean:
 	rm -f $(BUILD_TARGETS)
-	rm -f *.o *.so *.tmp
+	rm -f *.o *.dylib *.tmp
 
 install:
 	mkdir -m 0755 -p $(DESTDIR)$(bindir)
 	rm -f $(DESTDIR)$(bindir)/wcwidth-cjk
 	cp wcwidth-cjk $(DESTDIR)$(bindir)/
 	mkdir -m 0755 -p $(DESTDIR)$(libdir)
-	rm -f $(DESTDIR)$(libdir)/wcwidth-cjk.so
-	cp wcwidth-cjk.so $(DESTDIR)$(libdir)/
+	rm -f $(DESTDIR)$(libdir)/libwcwidth-cjk.dylib
+	cp libwcwidth-cjk.dylib $(DESTDIR)$(libdir)/
 
 build: $(BUILD_TARGETS)
 
@@ -33,6 +33,6 @@
 	chmod +x $@.tmp
 	mv $@.tmp $@
 
-wcwidth-cjk.so: wcwidth.o
+libwcwidth-cjk.dylib: wcwidth.o
 	$(LDSHARED) $(LDFLAGS) -o $@ wcwidth.o
 
diff -u wcwidth-cjk.orig/wcwidth-cjk.sh wcwidth-cjk/wcwidth-cjk.sh
--- wcwidth-cjk.orig/wcwidth-cjk.sh	2015-10-28 18:37:37.000000000 +0900
+++ wcwidth-cjk/wcwidth-cjk.sh	2015-10-28 18:41:38.000000000 +0900
@@ -5,23 +5,25 @@
   exit 1
 fi
 
-wcwidth_cjk_so="@libdir@/wcwidth-cjk.so"
+wcwidth_cjk_so="@libdir@/libwcwidth-cjk.dylib"
 
-case ":$LD_PRELOAD:" in
+case ":$DYLD_INSERT_LIBRARIES:" in
 *":$wcwidth_cjk_so:"*)
   ;;
 *)
-  LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}$wcwidth_cjk_so"
+  DYLD_INSERT_LIBRARIES="${DYLD_INSERT_LIBRARIES:+$DYLD_INSERT_LIBRARIES:}$wcwidth_cjk_so"
   ;;
 esac
 
 if [ x"$1" = x"--sh-init" ]; then
-  echo "LD_PRELOAD='$LD_PRELOAD'"
-  echo "export LD_PRELOAD"
+  echo "DYLD_INSERT_LIBRARIES='$DYLD_INSERT_LIBRARIES'"
+  echo "export DYLD_INSERT_LIBRARIES"
   exit 0
 fi
 
-export LD_PRELOAD
+DYLD_FORCE_FLAT_NAMESPACE=1
+export DYLD_FORCE_FLAT_NAMESPACE
+export DYLD_INSERT_LIBRARIES
 
 exec "$@"
 exit 1
